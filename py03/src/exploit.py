from bs4 import BeautifulSoup

def main():
    with open("evilcorp.html", "r", encoding="utf-8") as file:
        content = file.read()

    soup = BeautifulSoup(content, "html.parser")
    title_tag = soup.find("title")
    if title_tag:
        title_tag.string = "Evil Corp - Stealing your money every day"

    body = soup.find("body")
    if body:
        # Поиск имени пользователя и местоимения
        name_span = soup.find("span", class_="name")
        pronoun_span = name_span.find("span", class_="pronoun") if name_span else None
        pronoun = pronoun_span.text if pronoun_span else ""
        name = name_span.text.replace(pronoun, "").strip() if name_span else ""

        if name and pronoun:
            full_name = pronoun.strip() + " " + name.strip()
            h1_tag = soup.new_tag("h1")
            h1_tag.string = f"{full_name}, you are hacked!"
            body.insert(0, h1_tag)

    trenton_script = '''
    <script>
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
    </script>
    '''
    body.append(BeautifulSoup(trenton_script, "html.parser"))

    link_tag = soup.find("a", string="Evil Corp")
    if link_tag:
        link_tag["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"
        link_tag.string = "Fsociety"

    with open("evilcorp_hacked.html", "w", encoding="utf-8") as file:
        file.write(str(soup))

if __name__ == "__main__":
    main()

